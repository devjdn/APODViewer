<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oortcloud</title>
    
    <!--CSS FILES-->
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/fonts.css" />

    <!--JS FILES-->
    <script src="js/api.js"></script>
    <!-- <script src="js/header.js"></script> -->

    <!--ICONS-->
    <script src="https://kit.fontawesome.com/0719efe947.js" crossorigin="anonymous"></script>
    <link href='https://unpkg.com/css.gg@2.0.0/icons/css/menu.css' rel='stylesheet'>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!--EXTERNAL-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css">
</head>
<html>
<body>

    <div class="page-content">
        <header>
            <div class="header-content">
                <div class="header-name">
                    <h1>Oortcloud</h1>
                </div>
                <div class="page-link-container">
                    <div class="page-links" id="page-links">
                        <a href="#APOD"><div class="link"><p class="link-text">APOD</p></div></a>
                    </div>
                    <div class="page-links" id="page-links">
                        <a href="#rover"><div class="link"><p class="link-text">Mars Rover Photos</p></div></a>
                    </div>
                    <div class="page-links" id="page-links">
                        <a href="#EPIC"><div class="link"><p class="link-text">EPIC</p></div></a>
                    </div>
                    <div class="page-links" id="page-links">
                        <a href="#apod"><div class="link"><p class="link-text">Mars Weather Service</p></div></a>
                    </div>
                    <div class="page-links" id="page-links">
                        <a href="#apod"><div class="link"><p class="link-text">DONKI</p></div></a>
                    </div>
                    <div class="page-links" id="page-links">
                        <a href="news.html"><div class="link"><p class="link-text" id="newsboard">NewsBoard</p></div></a>
                    </div>
                </div>
            </div>
        </header>
        <div class="hero">
            <div class="title-description-wrapper">
                <p class="site-description">A Space API Project</p>
                <p class="site-description">API's provided by NASA, ESA, and Open Notify.</p>    
            </div>
        </div>
        <main>
            <div class="main-content">
                
                <section class="apod content-section" id="APOD">
                    <div class="section-title">
                        <h2>Astronomy Picture of the Day</h2>
                    </div>
                    <div class="apod-content api-content">
                        <div class="api-controls">
                            <div class="control-container">
                                <p class="control-label">Select a date between 16 June 1995 to the present day</p>
                                <div class="controls">
                                    <div class="date-input">
                                        <input type="date" name="" value="2006-08-09">
                                        <button class="fetch-apod fetch-data"><i class='bx bx-transfer'></i></button>
                                        <button class="apodPopupBtn" aria-toggle="open"><i class='bx bxs-info-square' ></i></button>
                                        <input type="number" id="countValue" value="4">
                                        <button class="fetch-count fetch-data"><i class='bx bx-transfer'></i></button>
                                    </div>
                                </div>
                                <div class="other-apods" id="apodImages">
                                    
                                </div>
                            </div>
                        </div>
                        <div class="img-container">
                            <div class="spinner">
                                <div class="spinner-items">
                                    <div class="spinner-animation">
                                        <div class="spinner-icon">
                                            <i class='bx bx-loader'></i>
                                        </div>
                                        <p class="spinner-text">Loading API data...</p>
                                    </div>
                                </div>
                            </div>
                            <img class="apod-img" src="" alt="">
                            <iframe src="" frameborder="0"></iframe>
                        </div>
                        <div class="apod-explan-popup" id="apodPopupMenu" aria-hidden="true">
                            <div class="apod-explan-container explan-container">
                                <div class="popup-header">
                                    <p class="explanation-title">APOD Explanation</p>
                                    <button class="apodPopupBtn" aria-toggle="close"><i class='bx bx-x' ></i></button>
                                </div>
                                <p class="apod-explanation explanation"></p>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="rover content-section" id="rover">
                    <div class="section-title">
                        <h2>Mars Rover Photos</h2>
                    </div>
                    <div class="rover-content api-content">
                        <div class="rover-explan-container explan-container">
                            <p class="explanation-title">Mars Rover Information</p>
                            <ul>
                                <li class="date-container">
                                    <p class="date-title">Earth date:</p>
                                    <p class="rover-earth-date"></p>
                                </li>
                                <li class="date-container">
                                    <p class="date-title">Launch date:</p>
                                    <p class="rover-launch-date"></p>
                                </li>
                                <li class="date-container">
                                    <p class="date-title">Landing date:</p>
                                    <p class="rover-landing-date"></p>
                                </li>
                            </ul>
                        </div>
                        <div class="img-container">
                            <div class="spinner">
                                <div class="spinner-items">
                                    <div class="spinner-animation">
                                        <div class="spinner-icon">
                                            <i class='bx bx-loader'></i>
                                        </div>
                                        <p class="spinner-text">Loading API data...</p>
                                    </div>
                                </div>
                            </div>
                            <img id="roverPhoto" src="" frameborder="0">
                        </div>
                    </div>
                </section>
                <!-- <section class="EPIC content-section" id="EPIC">
                    <div class="intro">
                        <div class="intro-text">
                            <h2>Earth Polychromatic Imaging Camera</h2>
                        </div>
                        <div class="EPIC controls">
                            <input class="data-range" type="date" name="" value="">
                            <button class="fetch-epic fetch-data">Fetch EPIC image</button>
                        </div>
                    </div>
                    <div class="epic-content api-content">
                        <div class="img-container">
                            <img class="epic-img" src="" alt="" frameborder="0">
                        </div>
                        <div class="epic-explan-container explan-container">
                            <p class="epic-explanation explanation"></p>
                        </div>
                    </div>
                </section> -->
                
            </div>
        </main>
        <footer>
            <div class="footer-content">
                <div class="site-info">
                    <p class="si-text">INFO VIA <a href="https://api.nasa.gov" target="_blank" style="text-decoration: underline;">API.NASA.GOV</a></p>
                    <p class="si-text">JAYDEN PRIESTLEY 2024</p>
                </div>
            </div>
        </footer>
    </div>
    <script>
        document.querySelector('.fetch-apod').addEventListener('click', getFetch);

        function getFetch(){
            const choice = document.querySelector('input').value;
            console.log(choice);

            const spinner = document.querySelector('.spinner');
            spinner.style.display = 'block'; // Show loading spinner

            const mainApodUrl = `https://api.nasa.gov/planetary/apod?api_key=8p7wu7IiHjpbujhNGUIRWU8QgAOORkuvVSFWxBEV&date=${choice}`;

            fetch(mainApodUrl)
            .then(res => res.json())
            .then(data => {
                console.log(data);
                if (data.media_type === 'image') {
                    document.querySelector('.apod-img').src = data.hdurl;
                    document.querySelector('iframe').style.display = 'none';
                    document.querySelector('.apod-img').style.display = 'block';
                } else if (data.media_type === 'video') {
                    document.querySelector('iframe').src = data.url;
                    document.querySelector('.apod-img').style.display = 'none';
                    document.querySelector('iframe').style.display = 'block';
                }
                document.querySelector('.apod-explanation').innerText = data.explanation;

                // Hide loading spinner after receiving response
                spinner.style.display = 'none';
            })
            .catch(err => {
                console.log(`error ${err}`);
                // Hide loading spinner in case of error
                spinner.style.display = 'none';
            });
        }

        getFetch();

        function fetchOtherApods() {
            const otherApodUrl = `https://api.nasa.gov/planetary/apod?api_key=8p7wu7IiHjpbujhNGUIRWU8QgAOORkuvVSFWxBEV&count=4`;
            const count = document.getElementById('countValue').value;

            fetch(otherApodUrl)
            .then(res => res.json())
            .then(data => {
                console.log(data);
                displayImages(data);
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        }
        function displayImages(apodData) {
                var apodImagesContainer = document.getElementById('apodImages');
                apodImagesContainer.innerHTML = ''; // Clear previous images

                apodData.forEach(apod => {
                    var img = document.createElement('img');
                    img.src = apod.url;
                    img.alt = apod.title;
                    apodImagesContainer.appendChild(img);
            });
        }

        fetchOtherApods();

        const apodPopupBtn = document.querySelectorAll('.apodPopupBtn');
        const apodPopupMenu = document.getElementById('apodPopupMenu');

        apodPopupBtn.forEach(button => {
            button.addEventListener('click', function() {
            const isHidden = apodPopupMenu.getAttribute('aria-hidden') === 'true';
            apodPopupMenu.setAttribute('aria-hidden', !isHidden);
        });
        });

        const apiKey = '8p7wu7IiHjpbujhNGUIRWU8QgAOORkuvVSFWxBEV'; 
        const rover = 'curiosity'; 
        const sol = '2000'; // Change to the sol (Martian day) you want to fetch the photo from 
        
        
        fetch(`https://api.nasa.gov/mars-photos/api/v1/rovers/${rover}/photos?sol=${sol}&api_key=${apiKey}`) 
        .then(response => response.json()) 
        .then(data => { // Assuming there is at least one photo 
            const photoUrl = data.photos[0].img_src; 
            const roverPhoto = document.getElementById('roverPhoto');
            roverPhoto.src = photoUrl;
            document.querySelector('.rover-earth-date').innerText = data.photos[0].earth_date;
            document.querySelector('.rover-launch-date').innerText = data.photos[0].rover.launch_date;
            document.querySelector('.rover-landing-date').innerText = data.photos[0].rover.landing_date;
            console.log(photoUrl); // Now you can use the photoUrl to display the image or do whatever you want with it 
        }) 
        
        .catch(error => console.error('Error fetching data:', error));
    </script>
</body>
</html>